#include "shadower/modules/exploit.h"
#include <dlfcn.h>
#include <iostream>

/* Function used to load exploit module */
create_exploit_t load_exploit(std::string& filename)
{
  /* Open the shared library */
  void* handle = dlopen(filename.c_str(), RTLD_LAZY);
  if (!handle) {
    std::cerr << "Error loading module: " + filename + " - " + dlerror() << std::endl;
    return nullptr;
  }

  /* Load the create_exploit function from the shared library */
  auto create_exploit = reinterpret_cast<create_exploit_t>(dlsym(handle, "create_exploit"));
  if (!create_exploit) {
    std::cerr << "Error loading symbol 'create_exploit' from " + filename + ": " + dlerror() << std::endl;
    dlclose(handle);
    return nullptr;
  }
  return create_exploit;
}